<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack知识点 | 木易的OT</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="随笔杂谈">
    
    <link rel="preload" href="/my-vuepress-blog/assets/css/0.styles.0eca5e6d.css" as="style"><link rel="preload" href="/my-vuepress-blog/assets/js/app.5b95effd.js" as="script"><link rel="preload" href="/my-vuepress-blog/assets/js/3.09b549b0.js" as="script"><link rel="preload" href="/my-vuepress-blog/assets/js/1.61ee8a6d.js" as="script"><link rel="preload" href="/my-vuepress-blog/assets/js/65.1d3f6a9c.js" as="script"><link rel="prefetch" href="/my-vuepress-blog/assets/js/10.93f745fb.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/11.6d20f46d.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/12.a1a9071e.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/13.7d3d3afb.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/14.1ee8b1c3.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/15.2f8f4d19.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/16.ec958f58.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/17.6dba1ae1.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/18.9010b644.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/19.1c7798ec.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/20.777fd7f9.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/21.8a493110.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/22.46433bb7.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/23.9de112aa.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/24.efeb1c7b.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/25.272a3678.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/26.810ea704.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/27.53a5d8d0.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/28.3aea0ffd.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/29.598d73b1.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/30.d6113ea0.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/31.085c6262.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/32.363daa26.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/33.e2a0acdb.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/34.6765fbdf.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/35.7ce03bbb.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/36.c6d15a86.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/37.dc069d2c.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/38.2d4de8e0.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/39.299cd9df.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/4.072fd4fb.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/40.675f506c.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/41.030bdb69.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/42.9b46b6bb.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/43.f48b8c66.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/44.07b9bc7d.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/45.f022c8e0.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/46.08cd9694.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/47.02131b69.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/48.9c5d599e.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/49.64ca210a.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/5.1c3238c4.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/50.70babce5.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/51.0eb64475.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/52.42177c82.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/53.14361df3.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/54.073b6248.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/55.f7329927.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/56.f897422a.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/57.fc6452fc.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/58.26c5850d.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/59.bb75ae9c.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/6.87b55cbb.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/60.cf148f56.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/61.bfe278a4.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/62.efe2862d.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/63.e1b7c0fc.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/64.d9c6f49b.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/66.6ebec5ee.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/67.66339b46.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/7.f7fa5881.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/8.64def537.js"><link rel="prefetch" href="/my-vuepress-blog/assets/js/9.7159a8ac.js">
    <link rel="stylesheet" href="/my-vuepress-blog/assets/css/0.styles.0eca5e6d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>木易的OT</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>随笔杂谈</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>EricYangXD</span>
            
          <!---->
          2022
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-vuepress-blog/" class="home-link router-link-active"><!----> <span class="site-name">木易的OT</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-vuepress-blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      木易的OT
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/EricYangXD" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2295436007445021" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><!----> <h3 class="name" data-v-39576ba9>
    EricYangXD
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>58</h3> <h6 data-v-39576ba9>文章</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>标签</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/my-vuepress-blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      木易的OT
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/EricYangXD" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2295436007445021" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/my-vuepress-blog/" class="sidebar-heading clickable router-link-active open"><span>About</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/my-vuepress-blog/" aria-current="page" class="sidebar-link">About me</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/my-vuepress-blog/handbook/React/SourceCode" class="sidebar-heading clickable"><span>React</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/my-vuepress-blog/handbook/Vue/SourceCode" class="sidebar-heading clickable"><span>Vue</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/my-vuepress-blog/handbook/LeetCode/BinaryTree" class="sidebar-heading clickable"><span>LeetCode</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/my-vuepress-blog/handbook/JavaScript/FrontEnd" class="sidebar-heading clickable"><span>JavaScript</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>AntDesign</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/my-vuepress-blog/handbook/Skill/DevelopmentSkills" class="sidebar-heading clickable"><span>开发技巧</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>油猴</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vite</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Google Chrome V8</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mac使用记录</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>文章诗句</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Webpack知识点</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>EricYangXD</span>
            
          <!---->
          2022
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title">Webpack知识点</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>EricYangXD</span></i> <i class="iconfont reco-date" data-v-f875f3fc><span data-v-f875f3fc>2022/2/10</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="详解-webpack-中的-hash、chunkhash、contenthash-区别"><a href="#详解-webpack-中的-hash、chunkhash、contenthash-区别" class="header-anchor">#</a> 详解 webpack 中的 hash、chunkhash、contenthash 区别</h2> <blockquote><p>hash 一般是结合 CDN 缓存来使用，通过 webpack 构建之后，生成对应文件名自动带上对应的 MD5 值。如果文件内容改变的话，那么对应文件哈希值也会改变，对应的 HTML 引用的 URL 地址也会改变，触发 CDN 服务器从源服务器上拉取对应数据，进而更新本地缓存。但是在实际使用的时候，这几种 hash 计算还是有一定区别。</p></blockquote> <h3 id="hash"><a href="#hash" class="header-anchor">#</a> hash</h3> <p>hash 是跟整个项目的构建相关，同一次构建过程中生成的哈希都是一样的，只要项目里有文件更改，整个项目构建的 hash 值都会更改，并且全部文件都共用相同的 hash 值。</p> <h3 id="chunkhash"><a href="#chunkhash" class="header-anchor">#</a> chunkhash</h3> <p>根据入口文件进行依赖文件解析、构建对应的 chunk，生成多个 bundle，把公共依赖库和我们的代码文件分开，但是如果某个文件变了，那么引用它的文件也会跟着改变。</p> <p>采用 hash 计算的话，每一次构建后生成的哈希值都不一样，即使文件内容压根没有改变。这样子是没办法实现缓存效果，我们需要换另一种哈希值计算方式，即 chunkhash。</p> <p>chunkhash 和 hash 不一样，它根据不同的入口文件(Entry)进行依赖文件解析、构建对应的 chunk，生成对应的哈希值。我们在生产环境里把一些公共库和程序入口文件区分开，单独打包构建，接着我们采用 chunkhash 的方式生成哈希值，那么只要我们不改动公共库的代码，就可以保证其哈希值不会受影响。</p> <h3 id="contenthash"><a href="#contenthash" class="header-anchor">#</a> contenthash</h3> <p>文件内容不改变，contenthash 就不变。</p> <p>在 chunkhash 的例子，我们可以看到由于 index.css 被 index.js 引用了，所以共用相同的 chunkhash 值。但是这样子有个问题，如果 index.js 更改了代码，css 文件就算内容没有任何改变，由于是该模块发生了改变，导致 css 文件会重复构建。</p> <p>这个时候，我们可以使用 extra-text-webpack-plugin 里的 contenthash 值，保证即使 css 文件所处的模块里就算其他文件内容改变，只要 css 文件内容不变，那么不会重复构建。</p> <p>一般用于 CDN。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 示例</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mini-css-extract-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 新增</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
	<span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
		<span class="token literal-property property">chunk1</span><span class="token operator">:</span> <span class="token string">&quot;./src/chunk1.js&quot;</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].[chunkhash].js&quot;</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token comment">// 新增</span>
		<span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token punctuation">{</span>
				<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
				<span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token comment">// 新增</span>
		<span class="token comment">// 提取css插件</span>
		<span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token comment">// Options similar to the same options in webpackOptions.output</span>
			<span class="token comment">// both options are optional</span>
			<span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;[name].[contenthash].css&quot;</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>hash 所有文件哈希值相同； chunkhash 根据不同的入口文件(Entry)进行依赖文件解析、构建对应的 chunk，生成对应的哈希值； contenthash 计算与文件内容本身相关，主要用在 css 抽取 css 文件时。</p> <ol><li><strong>不管是在 chunkhash 还是 contenthash，修改 css 都会引发 js 和 css 的改变；</strong></li> <li><strong>在 chunkhash 时，由于 js 和 css 的 chunkhash 是一样的，所以修改了 js，会导致整个 chunk 的 chunkhash 改变，它们俩是同一个 chunkhash，肯定就都变了；而在 contenthash 时，js 修改不会影响 css 的改变。</strong></li></ol> <h2 id="hot-module-replacement-hmr-热模块替换"><a href="#hot-module-replacement-hmr-热模块替换" class="header-anchor">#</a> Hot Module Replacement(HMR)--热模块替换</h2> <p>见名思意，即无需刷新在内存环境中即可替换掉过旧模块。与 Live Reload 相对应。在 webpack 的运行时中 <code>__webpack__modules__</code> 用以维护所有的模块。</p> <p>而热模块替换的原理，即通过 chunk 的方式加载最新的 modules，找到 <code>__webpack__modules__</code> 中对应的模块逐一替换，并删除其上下缓存。</p> <ol><li><code>webpack-dev-server</code> 将打包输出 bundle 使用内存型文件系统控制，而非真实的文件系统。此时使用的是 memfs (opens new window)模拟 node.js fs API;</li> <li>每当文件发生变更时，webpack 将会重新编译，<code>webpack-dev-server</code> 将会监控到此时文件变更事件，并找到其对应的 module。此时使用的是 chokidar (opens new window)监控文件变更;</li> <li><code>webpack-dev-server</code> 将会把变更模块通知到浏览器端，此时使用 websocket 与浏览器进行交流。此时使用的是 ws(opens new window);</li> <li>浏览器根据 websocket 接收到 hash，并通过 hash 以 JSONP 的方式请求更新模块的 chunk;</li> <li>浏览器加载 chunk，并使用新的模块对旧模块进行热替换，并删除其缓存;</li></ol> <h2 id="如何提升-webpack-构建资源的速度"><a href="#如何提升-webpack-构建资源的速度" class="header-anchor">#</a> 如何提升 webpack 构建资源的速度</h2> <h3 id="更快的-loader-swc"><a href="#更快的-loader-swc" class="header-anchor">#</a> 更快的 loader: swc</h3> <p>在 webpack 中耗时最久的当属负责 AST 转换的 loader。当 loader 进行编译时的 AST 操作均为 CPU 密集型任务，使用 Javascript 性能低下，此时可采用高性能语言 rust 编写的 swc。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token punctuation">{</span>
			<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.m?js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
			<span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(node_modules)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
			<span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;swc-loader&quot;</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="持久化缓存-cache"><a href="#持久化缓存-cache" class="header-anchor">#</a> 持久化缓存: cache</h3> <ol><li><p>webpack5 内置了关于缓存的插件，可通过以下配置开启。它将 Module、Chunk、ModuleChunk 等信息序列化到磁盘中，二次构建避免重复编译计算，编译速度得到很大提升。</p></li> <li><p>如对一个 JS 文件配置了 eslint、typescript、babel 等 loader，他将有可能执行五次编译，被五次解析为 AST：</p></li></ol> <ul><li>acorn: 用以依赖分析，解析为 acorn 的 AST</li> <li>eslint-parser: 用以 lint，解析为 espree 的 AST</li> <li>typescript: 用以 ts，解析为 typescript 的 AST</li> <li>babel: 用以转化为低版本，解析为 @babel/parser 的 AST</li> <li>terser: 用以压缩混淆，解析为 acorn 的 AST</li></ul> <p>而当开启了持久化缓存功能，最耗时的 AST 解析将能够从磁盘的缓存中获取，再次编译时无需再次进行解析 AST。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
	<span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;filesystem&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>在 webpack4 中，可使用 cache-loader 仅仅对 loader 进行缓存。需要注意的是该 loader 目前已是 @depcrated 状态。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token punctuation">{</span>
				<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.ext$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
				<span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;cache-loader&quot;</span><span class="token punctuation">,</span> <span class="token operator">...</span>loaders<span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token literal-property property">include</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="多进程-thread-loader"><a href="#多进程-thread-loader" class="header-anchor">#</a> 多进程: thread-loader</h3> <ol><li>thread-loader 为官方推荐的开启多进程的 loader，可对 babel 解析 AST 时开启多线程处理，提升编译的性能。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token punctuation">{</span>
				<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
				<span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
					<span class="token punctuation">{</span>
						<span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;thread-loader&quot;</span><span class="token punctuation">,</span>
						<span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
							<span class="token literal-property property">workers</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
						<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
				<span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>在 webpack4 中，可使用 happypack plugin，但需要注意的是 happypack 已经久不维护了。</li></ol> <h2 id="如何分析前端打包体积"><a href="#如何分析前端打包体积" class="header-anchor">#</a> 如何分析前端打包体积</h2> <p>在 webpack 中，可以使用 webpack-bundle-analyzer (opens new window)分析打包后体积分析。</p> <p>其原理是根据 webpack 打包后的 Stats (opens new window)数据进行分析，在 webpack compiler 的 done hook (opens new window)进行处理。</p> <div class="language-js extra-class"><pre class="language-js"><code>compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-bundle-analyzer&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在查看页面中，有三个体积选项：</p> <ul><li>stat: 每个模块的原始体积</li> <li>parsed: 每个模块经 webpack 打包处理之后的体积，比如 terser 等做了压缩，便会体现在上边</li> <li>gzip: 经 gzip 压缩后的体积</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ANALYZE=true npm run build 设置环境变量</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> BundleAnalyzerPlugin <span class="token operator">=</span>
	<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-bundle-analyzer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BundleAnalyzerPlugin<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./index.js&quot;</span><span class="token punctuation">,</span>
		<span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span>
		<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">ANALYZE</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stat</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="如何正确地进行分包"><a href="#如何正确地进行分包" class="header-anchor">#</a> 如何正确地进行分包</h2> <h3 id="为什么需要分包"><a href="#为什么需要分包" class="header-anchor">#</a> 为什么需要分包？</h3> <ol><li>一行代码将导致整个 bundle.js 的缓存失效</li> <li>一个页面仅仅需要 bundle.js 中 1/N 的代码，剩下代码属于其它页面，完全没有必要加载</li></ol> <h3 id="如何更好的分包"><a href="#如何更好的分包" class="header-anchor">#</a> 如何更好的分包？</h3> <h4 id="打包工具运行时"><a href="#打包工具运行时" class="header-anchor">#</a> 打包工具运行时</h4> <p>webpack(或其他构建工具) 运行时代码不容易变更，需要单独抽离出来，比如 webpack.runtime.js。由于其体积小，必要时可注入 index.html 中，减少 HTTP 请求数，优化关键请求路径</p> <h4 id="前端框架运行时"><a href="#前端框架运行时" class="header-anchor">#</a> 前端框架运行时</h4> <p>React(Vue) 运行时代码不容易变更，且每个组件都会依赖它，可单独抽离出来 framework.runtime.js。请且注意，务必将 React 及其所有依赖(react-dom/object-assign)共同抽离出来，否则有可能造成性能损耗。(因 webpack 依赖其 object-assign，而 object-assign 将被打入共同依赖 vendor.chunk.js，因此此时它必回加载，但是该页面并不依赖任何第三方库，完全没有必要全部加载 vendor.chunk.js)</p> <h4 id="高频库"><a href="#高频库" class="header-anchor">#</a> 高频库</h4> <p>一个模块被 N(2 个以上) 个 Chunk 引用，可称为公共模块，可把公共模块给抽离出来，形成 vendor.js。</p> <ol><li>问：那如果一个模块被用了多次 (2 次以上)，但是该模块体积过大(1MB)，每个页面都会加载它(但是无必要，因为不是每个页面都依赖它)，导致性能变差，此时如何分包？</li></ol> <ul><li>答：如果一个模块虽是公共模块，但是该模块体积过大，可直接 import() 引入，异步加载，单独分包，比如 echarts 等</li></ul> <ol start="2"><li>问：如果公共模块数量多，导致 vendor.js 体积过大(1MB)，每个页面都会加载它，导致性能变差，此时如何分包</li></ol> <p>答：有以下两个思路</p> <ul><li>思路一: 可对 vendor.js 改变策略，比如被引用了十次以上，被当做公共模块抽离成 verdor-A.js，五次的抽离为 vendor-B.js，两次的抽离为 vendor-C.js</li> <li>思路二: 控制 vendor.js 的体积，当大于 100KB 时，再次进行分包，多分几个 vendor-XXX.js，但每个 vendor.js 都不超过 100KB</li></ul> <h4 id="使用-webpack-分包"><a href="#使用-webpack-分包" class="header-anchor">#</a> 使用 webpack 分包</h4> <ul><li>在 webpack 中可以使用 SplitChunksPlugin (opens new window)进行分包，它需要满足三个条件:</li></ul> <ol><li>minChunks: 一个模块是否最少被 minChunks 个 chunk 所引用</li> <li>maxInitialRequests/maxAsyncRequests: 最多只能有 maxInitialRequests/maxAsyncRequests 个 chunk 需要同时加载 (如一个 Chunk 依赖 VendorChunk 才可正常工作，此时同时加载 chunk 数为 2)</li> <li>minSize/maxSize: chunk 的体积必须介于 (minSize, maxSize) 之间</li></ol> <ul><li>以下是 next.js 的默认配置，可视作最佳实践: 源码位置: <a href="https://github.com/vercel/next.js/blob/v12.0.5-canary.10/packages/next/build/webpack-config.ts#L728" target="_blank" rel="noopener noreferrer">next/build/webpack-config.ts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token comment">// Keep main and _app chunks unsplitted in webpack 5</span>
  <span class="token comment">// as we don't need a separate vendor chunk from that</span>
  <span class="token comment">// and all other chunk depend on them so there is no</span>
  <span class="token comment">// duplication that need to be pulled out.</span>
  <span class="token function-variable function">chunks</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(polyfills|main|pages\/_app)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    <span class="token operator">!</span><span class="token constant">MIDDLEWARE_ROUTE</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">framework</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">chunks</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">chunk</span><span class="token operator">:</span> webpack<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span>Chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token operator">!</span>chunk<span class="token punctuation">.</span>name<span class="token operator">?.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token constant">MIDDLEWARE_ROUTE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'framework'</span><span class="token punctuation">,</span>
      <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> resource <span class="token operator">=</span>
          module<span class="token punctuation">.</span>nameForCondition <span class="token operator">&amp;&amp;</span> module<span class="token punctuation">.</span><span class="token function">nameForCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>resource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> topLevelFrameworkPaths<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">packagePath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
          resource<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>packagePath<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
      <span class="token comment">// Don't let webpack eliminate this chunk (prevents this chunk from</span>
      <span class="token comment">// becoming a part of the commons chunk)</span>
      <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">lib</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">test</span><span class="token punctuation">(</span>module<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> Function
        <span class="token literal-property property">nameForCondition</span><span class="token operator">:</span> Function
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
          module<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">160000</span> <span class="token operator">&amp;&amp;</span>
          <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules[/\\]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span><span class="token function">nameForCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">name</span><span class="token punctuation">(</span>module<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> string
        libIdent<span class="token operator">?</span><span class="token operator">:</span> Function
        <span class="token function-variable function">updateHash</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">hash</span><span class="token operator">:</span> crypto<span class="token punctuation">.</span>Hash</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span>
        <span class="token keyword">const</span> hash <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">'sha1'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isModuleCSS</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          module<span class="token punctuation">.</span><span class="token function">updateHash</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>module<span class="token punctuation">.</span>libIdent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>
              <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Encountered unknown module type: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>module<span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Please open an issue.</span><span class="token template-punctuation string">`</span></span>
            <span class="token punctuation">)</span>
          <span class="token punctuation">}</span>

          hash<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span><span class="token function">libIdent</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">context</span><span class="token operator">:</span> dir <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> hash<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">commons</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'commons'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minChunks</span><span class="token operator">:</span> totalPages<span class="token punctuation">,</span>
      <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">middleware</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">chunks</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">chunk</span><span class="token operator">:</span> webpack<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span>Chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        chunk<span class="token punctuation">.</span>name<span class="token operator">?.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token constant">MIDDLEWARE_ROUTE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'server/middleware-chunks/[name].js'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">maxInitialRequests</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
  <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="js-代码压缩-minify-的原理是什么"><a href="#js-代码压缩-minify-的原理是什么" class="header-anchor">#</a> JS 代码压缩 minify 的原理是什么</h2> <p>通过 AST 分析，根据选项配置一些策略，来生成一棵更小体积的 AST 并生成代码。</p> <p>目前前端工程化中使用 terser 和 swc 进行 JS 代码压缩，他们拥有相同的 API。</p> <p>常见用以压缩 AST 的几种方案如下:</p> <h3 id="去除多余字符-空格-换行及注释"><a href="#去除多余字符-空格-换行及注释" class="header-anchor">#</a> 去除多余字符: 空格，换行及注释</h3> <p>一般来说中文会占用更大的空间。多行代码压缩到一行时要注意行尾分号。</p> <h3 id="压缩变量名-变量名-函数名及属性名"><a href="#压缩变量名-变量名-函数名及属性名" class="header-anchor">#</a> 压缩变量名：变量名，函数名及属性名</h3> <p>缩短变量的命名也需要 AST 支持，不至于在作用域中造成命名冲突。</p> <h3 id="解析程序逻辑-合并声明以及布尔值简化"><a href="#解析程序逻辑-合并声明以及布尔值简化" class="header-anchor">#</a> 解析程序逻辑：合并声明以及布尔值简化</h3> <h3 id="解析程序逻辑-编译预计算"><a href="#解析程序逻辑-编译预计算" class="header-anchor">#</a> 解析程序逻辑: 编译预计算</h3> <p>在编译期进行计算，减少运行时的计算量。</p> <h2 id="_15-个-webpack-优化点"><a href="#_15-个-webpack-优化点" class="header-anchor">#</a> 15 个 Webpack 优化点</h2> <h3 id="构建时间的优化"><a href="#构建时间的优化" class="header-anchor">#</a> 构建时间的优化</h3> <h4 id="thread-loader"><a href="#thread-loader" class="header-anchor">#</a> thread-loader</h4> <p>多进程打包，可以大大提高构建的速度，使用方法是将 thread-loader 放在比较费时间的 loader 之前，比如 babel-loader，数组中右侧的 loader 先执行。</p> <h4 id="cache-loader"><a href="#cache-loader" class="header-anchor">#</a> cache-loader</h4> <p>缓存资源，提高二次构建的速度，使用方法是将 cache-loader 放在比较费时间的 loader 之前，比如 babel-loader，同上。</p> <h4 id="开启热更新"><a href="#开启热更新" class="header-anchor">#</a> 开启热更新</h4> <p>在 plugins 中增加 webpack 提供的热更新插件<code>new webpack.HotModuleReplacementPlugin()</code>，并配置<code>devServer.hot=true</code>。</p> <h4 id="合理设置-exclude-include"><a href="#合理设置-exclude-include" class="header-anchor">#</a> 合理设置 exclude &amp; include</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token comment">//....</span>
  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  <span class="token comment">//使用include来指定编译文件夹</span>
  <span class="token literal-property property">include</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">//使用exclude排除指定文件夹</span>
  <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'babel-loader'</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="构建区分环境"><a href="#构建区分环境" class="header-anchor">#</a> 构建区分环境</h4> <ol><li>开发环境：去除代码压缩、gzip、体积分析等优化的配置，大大提高构建速度</li> <li>生产环境：需要代码压缩、gzip、体积分析等优化的配置，大大降低最终项目打包体积</li></ol> <h4 id="提升-webpack-版本"><a href="#提升-webpack-版本" class="header-anchor">#</a> 提升 webpack 版本</h4> <h3 id="打包体积优化"><a href="#打包体积优化" class="header-anchor">#</a> 打包体积优化</h3> <p>主要是打包后项目整体体积的优化，有利于项目上线后的页面加载速度提升</p> <h4 id="css-代码压缩"><a href="#css-代码压缩" class="header-anchor">#</a> CSS 代码压缩</h4> <p>CSS 代码压缩使用<code>css-minimizer-webpack-plugin</code>，效果包括压缩、去重</p> <h4 id="js-代码压缩"><a href="#js-代码压缩" class="header-anchor">#</a> JS 代码压缩</h4> <ul><li>JS 代码压缩使用<code>terser-webpack-plugin</code>或者 uglify，实现打包后 JS 代码的压缩；</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> CssMinimizerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'css-minimizer-webpack-plugin'</span><span class="token punctuation">)</span>

  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">minimizer</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">CssMinimizerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 去重压缩css</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 压缩JS代码</span>
        <span class="token literal-property property">terserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">drop_console</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 去除console</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 压缩JavaScript</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</code></pre></div><h4 id="tree-shaking"><a href="#tree-shaking" class="header-anchor">#</a> tree-shaking</h4> <p>tree-shaking 简单说作用就是：只打包用到的代码，没用到的代码不打包，而 webpack5 默认开启 tree-shaking，当打包的 mode 为 production 时，自动开启 tree-shaking 进行优化</p> <h4 id="source-map-类型"><a href="#source-map-类型" class="header-anchor">#</a> source-map 类型</h4> <p>source-map 的作用是：方便你报错的时候能定位到错误代码的位置。它的体积不容小觑，所以对于不同环境设置不同的类型是很有必要的。</p> <ol><li>开发环境: <code>devtool: 'eval-cheap-module-source-map'</code>, 开发环境的时候我们需要能精准定位错误代码的位置</li> <li>生产环境: <code>devtool: 'nosources-source-map'</code>, 生产环境，我们想开启 source-map，但是又不想体积太大，那么可以换一种类型</li></ol> <h4 id="打包体积分析"><a href="#打包体积分析" class="header-anchor">#</a> 打包体积分析</h4> <p>使用<code>webpack-bundle-analyzer</code>插件可以审查打包后的体积分布，进而进行相应的体积优化</p> <h3 id="用户体验优化"><a href="#用户体验优化" class="header-anchor">#</a> 用户体验优化</h3> <h4 id="模块懒加载"><a href="#模块懒加载" class="header-anchor">#</a> 模块懒加载</h4> <p>如果不进行模块懒加载的话，最后整个项目代码都会被打包到一个 js 文件里，单个 js 文件体积非常大，那么当用户网页请求的时候，首屏加载时间会比较长，使用模块懒加载之后，大 js 文件会分成多个小 js 文件，网页加载时会按需加载，大大提升首屏加载速度。在配置路由时使用 lazy 动态 import 页面组件。</p> <h4 id="gzip"><a href="#gzip" class="header-anchor">#</a> Gzip</h4> <p>使用<code>compression-webpack-plugin</code>，开启 Gzip 后，大大提高用户的页面加载速度，因为 gzip 的体积比原文件小很多，当然也需要后端的配合。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
	<span class="token comment">// ...</span>
	<span class="token comment">// gzip</span>
	<span class="token keyword">new</span> <span class="token class-name">CompressionPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token literal-property property">algorithm</span><span class="token operator">:</span> <span class="token string">&quot;gzip&quot;</span><span class="token punctuation">,</span>
		<span class="token literal-property property">threshold</span><span class="token operator">:</span> <span class="token number">10240</span><span class="token punctuation">,</span>
		<span class="token literal-property property">minRatio</span><span class="token operator">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-zsh extra-class"><pre class="language-text"><code># 开启和关闭gzip模式
gzip on;
# gizp压缩起点，文件大于1k才进行压缩
gzip_min_length 1k;
# 设置压缩所需要的缓冲区大小，以4k为单位，如果文件为7k则申请2*4k的缓冲区
gzip_buffers 4 16k;
# 设置gzip压缩针对的HTTP协议版本
gzip_http_version 1.0;
# gzip 压缩级别，1-9，数字越大压缩的越好，也越占用CPU时间
gzip_comp_level 2;
# 进行压缩的文件类型
gzip_types text/plain application/javascript text/css application/xml;
# 是否在http header中添加Vary: Accept-Encoding，建议开启
gzip_vary on;
</code></pre></div><h4 id="小图片转-base64"><a href="#小图片转-base64" class="header-anchor">#</a> 小图片转 base64</h4> <p>对于一些小图片，可以转 base64，这样可以减少用户的 http 网络请求次数，提高用户的体验。webpack5 中<code>url-loader</code>已被废弃，改用<code>asset-module</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
   <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg|webp)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
   <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'asset'</span><span class="token punctuation">,</span>
   <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token comment">// 转base64的条件</span>
     <span class="token literal-property property">dataUrlCondition</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">maxSize</span><span class="token operator">:</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token comment">// 25kb</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token literal-property property">generator</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token comment">// 打包到 image 文件下</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'images/[contenthash][ext][query]'</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="合理配置-hash"><a href="#合理配置-hash" class="header-anchor">#</a> 合理配置 hash</h4> <p>我们要保证，改过的文件需要更新 hash 值，而没改过的文件依然保持原本的 hash 值，这样才能保证在上线后，浏览器访问时没有改变的文件会命中缓存，从而达到性能优化的目的。</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 给js文件加上 contenthash</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'js/chunk-[contenthash].js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">clean</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="首屏优化之-cdn-加速"><a href="#首屏优化之-cdn-加速" class="header-anchor">#</a> 首屏优化之 CDN 加速</h4> <p>通过把类似 echart、element-ui、lodash 等第三方依赖库单独提取出，从而减小打包的体积大小，通过 chainWebpack 中配置 externals 属性后的依赖插件不会被打包进 chunk 。而使用 CDN 加速、缓存也能加快访问速度。</p> <ol><li>在 index.html 中手动引入 cdn 链接。并修改 webpack 配置，不再把 cdn 引入的依赖打包进 chunk。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">IS_PRO</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token comment">//... 其他基本配置</span>
	<span class="token function-variable function">chainWebpack</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">IS_PRO</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			config<span class="token punctuation">.</span><span class="token function">externals</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">echarts</span><span class="token operator">:</span> <span class="token string">&quot;echarts&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>通过 html-webpack-plugin 将 cdn 注入到 index.html 之中。需要修改 webpack 配置。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> cdn <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token literal-property property">js</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://cdn.jsdelivr.net/npm/echarts@4.8.0/dist/echarts.min.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 通过 html-webpack-plugin 将 cdn 注入到 index.html 之中</span>
config<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cdn <span class="token operator">=</span> cdn<span class="token punctuation">;</span>
	<span class="token keyword">return</span> args<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="首屏优化之代码分割-splitchunks-拆包优化"><a href="#首屏优化之代码分割-splitchunks-拆包优化" class="header-anchor">#</a> 首屏优化之代码分割-splitChunks 拆包优化</h4> <ol><li>Bundle Splitting: 这个过程提供了一种优化构建的方法，允许 webpack 为单个应用程序生成多个 bundle 文件。因此，可以将每个 bundle 文件与影响其他文件的更改进行分离，从而减少重新发布并由此被客户端重新下载的代码量，并且运用浏览器「缓存」。
<ul><li>拆分的越小，文件越多，可能会有更多 Webpack 的辅助代码，也会带来更少的合并压缩。但是，通过数据分析，文件拆分越多，性能会更好。</li></ul></li> <li>Code Splitting: 代码分离指将代码分成不同的包/块，然后可以「按需加载」，而不是加载包含所有内容的单个包。一般配合路由懒加载。通过 Webpack4 的 import()语法。</li></ol> <ul><li>webpack 默认配置下会把所有的依赖和插件都打包到 vendors.js 中，有些可能是 app.js 。所以，对于大量引入第三方依赖的项目，这个文件会非常的大。而对于在特定页面中才会使用的插件也会造成性能浪费。这时拆分和异步就显得尤为重要了。</li> <li>包的大小本地打包完成时可以看到，若想更仔细的分析可以通过插件 <code>webpack-bundle-analyzer</code>；</li> <li></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&quot;async&quot;</span><span class="token punctuation">,</span><span class="token comment">// 哪些chunks需要进行优化，async-按需引入的模块将会被用于优化，initial-被直接引入的模块将会被用于优化，all-全部都会被用于优化。</span>
    <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span><span class="token comment">// 打包优化完生成的新chunk大小要&gt; 30000字节，否则不生成新chunk。</span>
    <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token comment">// 共享该module的最小chunk数</span>
    <span class="token literal-property property">maxAsyncRequests</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span><span class="token comment">// 最多有N个异步加载请求该module</span>
    <span class="token literal-property property">maxInitialRequests</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token comment">// 一个入口文件可以并行加载的最大文件数量</span>
    <span class="token literal-property property">automaticNameDelimiter</span><span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span><span class="token comment">// 名字中间的间隔符</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">// chunk的名字，true-自动生成，false-由 id 决定，string-缓存组最终会打包成一个 chunk，名称就是该 string。</span>
    <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token comment">// 要切割成的每一个新chunk就是一个cache group。</span>
      <span class="token literal-property property">styles</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'style'</span><span class="token punctuation">,</span>
          <span class="token function-variable function">test</span><span class="token operator">:</span> <span class="token parameter">m</span> <span class="token operator">=&gt;</span> m<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'CssModule'</span><span class="token punctuation">,</span><span class="token comment">// 用来决定提取哪些module，可以接受字符串，正则表达式，或者函数，函数的一个参数为module，第二个参数为引用这个module的chunk(数组)。</span>
          <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">emcommon</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'emcommon'</span><span class="token punctuation">,</span>
          <span class="token function-variable function">test</span><span class="token operator">:</span> <span class="token parameter">module</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">const</span> regs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@ant-design</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@em</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@bytedesign</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span> regs<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">reg</span> <span class="token operator">=&gt;</span> reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span><span class="token comment">// 优先级一样的话，size大的优先被选择。</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">byteedu</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'byteedu'</span><span class="token punctuation">,</span>
          <span class="token function-variable function">test</span><span class="token operator">:</span> <span class="token parameter">module</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">const</span> regs <span class="token operator">=</span> <span class="token punctuation">[</span>
                  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@ax</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@bridge</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">axios</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">lodash</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@byted-edu</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">codemirror</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@syl-editor</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">prosemirror</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span> regs<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">reg</span> <span class="token operator">=&gt;</span> reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">// 当module未变时，是否可以使用之前的chunk。</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="webpack-构建流程"><a href="#webpack-构建流程" class="header-anchor">#</a> webpack 构建流程</h2> <ol><li>通过 yargs 解析 config 和 shell 的配置项</li> <li>webpack 初始化过程，首先会根据第一步的 options 生成 compiler 对象，然后初始化 webpack 的内置插件及 options 配置</li> <li>run 代表编译的开始，会构建 compilation 对象，用于存储这一次编译过程的所有数据</li> <li>make 执行真正的编译构建过程，从入口文件开始，构建模块，直到所有模块创建结束</li> <li>seal 生成 chunks，对 chunks 进行一系列的优化操作，并生成要输出的代码</li> <li>seal 结束后，Compilation 实例的所有工作到此也全部结束，意味着一次构建过程已经结束</li></ol> <p>Webpack 插件统一以 apply 方法为入口，然后注册优化事件，apply 方法接收一个参数，该参数是 webpack 初始化过程中生成的 compiler 对象的引用，从而可以在回调函数中访问到 compiler 对象。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//Compiler 对象包含了 Webpack 环境的所有配置信息，包含options、loaders、plugins等信息。这个对象在 Webpack 启动时被实例化，它是全局唯一的，可以简单地将它理解为 Webpack 实例。</span>
  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>thisCompilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;SplitChunksPlugin&quot;</span><span class="token punctuation">,</span> <span class="token parameter">compilation</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//Compilation 对象包含了当前的模块资源、编译生成资源、变化的文件等。当 Webpack 以开发模式运行时，每当检测到一个文件变化，一次新的 Compilation 将被创建。Compilation 对象也提供了很多事件回调供插件做扩展。通过 Compilation 也能读取到 Compiler 对象。</span>
    <span class="token keyword">let</span> alreadyOptimized <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">//当编译开始接受新模块时触发</span>
    compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>unseal<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;SplitChunksPlugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      alreadyOptimized <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//在块优化阶段的开始时调用。插件可以利用此钩子来执行块优化。</span>
    compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>optimizeChunksAdvanced<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>
      <span class="token string">&quot;SplitChunksPlugin&quot;</span><span class="token punctuation">,</span>
      <span class="token parameter">chunks</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">//核心代码</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2022/6/5 18:25:21</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#详解-webpack-中的-hash、chunkhash、contenthash-区别" class="sidebar-link reco-side-详解-webpack-中的-hash、chunkhash、contenthash-区别" data-v-cb1513f6>详解 webpack 中的 hash、chunkhash、contenthash 区别</a></li><li class="level-3" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#hash" class="sidebar-link reco-side-hash" data-v-cb1513f6>hash</a></li><li class="level-3" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#chunkhash" class="sidebar-link reco-side-chunkhash" data-v-cb1513f6>chunkhash</a></li><li class="level-3" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#contenthash" class="sidebar-link reco-side-contenthash" data-v-cb1513f6>contenthash</a></li><li class="level-3" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#总结" class="sidebar-link reco-side-总结" data-v-cb1513f6>总结</a></li><li class="level-2" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#hot-module-replacement-hmr-热模块替换" class="sidebar-link reco-side-hot-module-replacement-hmr-热模块替换" data-v-cb1513f6>Hot Module Replacement(HMR)--热模块替换</a></li><li class="level-2" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#如何提升-webpack-构建资源的速度" class="sidebar-link reco-side-如何提升-webpack-构建资源的速度" data-v-cb1513f6>如何提升 webpack 构建资源的速度</a></li><li class="level-3" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#更快的-loader-swc" class="sidebar-link reco-side-更快的-loader-swc" data-v-cb1513f6>更快的 loader: swc</a></li><li class="level-3" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#持久化缓存-cache" class="sidebar-link reco-side-持久化缓存-cache" data-v-cb1513f6>持久化缓存: cache</a></li><li class="level-3" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#多进程-thread-loader" class="sidebar-link reco-side-多进程-thread-loader" data-v-cb1513f6>多进程: thread-loader</a></li><li class="level-2" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#如何分析前端打包体积" class="sidebar-link reco-side-如何分析前端打包体积" data-v-cb1513f6>如何分析前端打包体积</a></li><li class="level-2" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#如何正确地进行分包" class="sidebar-link reco-side-如何正确地进行分包" data-v-cb1513f6>如何正确地进行分包</a></li><li class="level-3" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#为什么需要分包" class="sidebar-link reco-side-为什么需要分包" data-v-cb1513f6>为什么需要分包？</a></li><li class="level-3" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#如何更好的分包" class="sidebar-link reco-side-如何更好的分包" data-v-cb1513f6>如何更好的分包？</a></li><li class="level-2" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#js-代码压缩-minify-的原理是什么" class="sidebar-link reco-side-js-代码压缩-minify-的原理是什么" data-v-cb1513f6>JS 代码压缩 minify 的原理是什么</a></li><li class="level-3" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#去除多余字符-空格-换行及注释" class="sidebar-link reco-side-去除多余字符-空格-换行及注释" data-v-cb1513f6>去除多余字符: 空格，换行及注释</a></li><li class="level-3" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#压缩变量名-变量名-函数名及属性名" class="sidebar-link reco-side-压缩变量名-变量名-函数名及属性名" data-v-cb1513f6>压缩变量名：变量名，函数名及属性名</a></li><li class="level-3" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#解析程序逻辑-合并声明以及布尔值简化" class="sidebar-link reco-side-解析程序逻辑-合并声明以及布尔值简化" data-v-cb1513f6>解析程序逻辑：合并声明以及布尔值简化</a></li><li class="level-3" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#解析程序逻辑-编译预计算" class="sidebar-link reco-side-解析程序逻辑-编译预计算" data-v-cb1513f6>解析程序逻辑: 编译预计算</a></li><li class="level-2" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#_15-个-webpack-优化点" class="sidebar-link reco-side-_15-个-webpack-优化点" data-v-cb1513f6>15 个 Webpack 优化点</a></li><li class="level-3" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#构建时间的优化" class="sidebar-link reco-side-构建时间的优化" data-v-cb1513f6>构建时间的优化</a></li><li class="level-3" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#打包体积优化" class="sidebar-link reco-side-打包体积优化" data-v-cb1513f6>打包体积优化</a></li><li class="level-3" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#用户体验优化" class="sidebar-link reco-side-用户体验优化" data-v-cb1513f6>用户体验优化</a></li><li class="level-2" data-v-cb1513f6><a href="/my-vuepress-blog/handbook/Webpack/Basic.html#webpack-构建流程" class="sidebar-link reco-side-webpack-构建流程" data-v-cb1513f6>webpack 构建流程</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/my-vuepress-blog/assets/js/app.5b95effd.js" defer></script><script src="/my-vuepress-blog/assets/js/3.09b549b0.js" defer></script><script src="/my-vuepress-blog/assets/js/1.61ee8a6d.js" defer></script><script src="/my-vuepress-blog/assets/js/65.1d3f6a9c.js" defer></script>
  </body>
</html>
