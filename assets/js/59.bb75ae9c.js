(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{629:function(t,e,s){"use strict";s.r(e);var a=s(10),v=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"组成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#组成"}},[t._v("#")]),t._v(" 组成")]),t._v(" "),s("p",[t._v("主要由两部分组成：")]),t._v(" "),s("ol",[s("li",[t._v("一个开发服务器，它基于 原生 ES Module 提供了 丰富的内建功能，如速度快到惊人的 模块热更新（HMR）。")]),t._v(" "),s("li",[t._v("一套构建指令，它使用 Rollup 打包代码，并且它是预配置的，可输出用于生产环境的高度优化过的静态资源。")]),t._v(" "),s("li",[t._v("即开发的时候用 esbuild，生产打包用 rollup")])]),t._v(" "),s("h2",{attrs:{id:"原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[t._v("#")]),t._v(" 原理")]),t._v(" "),s("blockquote",[s("p",[t._v("以下引用自"),s("a",{attrs:{href:"https://cn.vitejs.dev/guide/why.html#slow-server-start",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vite 官方中文文档"),s("OutboundLink")],1)])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Vite 通过在一开始将应用中的模块区分为 「依赖」 和 「源码」 两类，改进了开发服务器启动时间。")])]),t._v(" "),s("li",[s("p",[t._v("依赖 大多为在开发时不会变动的纯 JavaScript。Vite 将会使用 esbuild 预构建依赖。")])]),t._v(" "),s("li",[s("p",[t._v("源码 通常包含一些并非直接是 JavaScript 的文件，需要转换（例如 JSX，CSS 或者 Vue/Svelte 组件），时常会被编辑。同时，并不是所有的源码都需要同时被加载（例如基于路由拆分的代码模块）。")])]),t._v(" "),s("li",[s("p",[t._v("Vite 以 原生 ESM 方式提供源码。这实际上是让浏览器接管了打包程序的部分工作：Vite 只需要在浏览器请求源码时进行转换并按需提供源码。根据情景动态导入代码，即只在当前屏幕上实际使用时才会被处理。")])]),t._v(" "),s("li",[s("p",[s("img",{attrs:{src:"https://cn.vitejs.dev/assets/esm.3070012d.png",alt:"Vite原理图",title:"Vite原理图"}})])])]),t._v(" "),s("ol",{attrs:{start:"0"}},[s("li",[t._v("esbuild 构建之后，会对「依赖包」的请求设置强缓存"),s("code",[t._v("cache-control:max-age=31536000,immutable;")])]),t._v(" "),s("li",[t._v("在启动的时候，vite 并不会打包源码，而是在浏览器请求路由时才会进行打包，而且也仅仅打包当前路由的源码。这相当于让浏览器掌握了打包的控制权，从而将"),s("code",[t._v("Bundle based dev server")]),t._v("(如 webpack)一次性打包全部源码的操作改为了多次，启动速度无疑会快非常多。")]),t._v(" "),s("li",[t._v("在访问时转换的速度也不会慢下来，因为每次转换的源码只有在当前路由下的，并且「源码模块」还会设置协商缓存，当模块没有改变时，浏览器的请求会返回 304 Not Modified。")])]),t._v(" "),s("h2",{attrs:{id:"优势"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优势"}},[t._v("#")]),t._v(" 优势")]),t._v(" "),s("h3",{attrs:{id:"vite-天然支持引入-ts、-jsx、-css-等文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vite-天然支持引入-ts、-jsx、-css-等文件"}},[t._v("#")]),t._v(" Vite 天然支持引入.ts、.jsx、.css 等文件")]),t._v(" "),s("ol",[s("li",[t._v("Vite 使用 esbuild 将 ts 转译为 js，约是 tsc 速度的 20-30 倍，同时 HMR 更新反映到浏览器的时间小于 50ms")]),t._v(" "),s("li",[t._v(".jsx 和.tsx 文件同样开箱即用。JSX 的转译同样是通过 esbuild，默认为 react16 风格")]),t._v(" "),s("li",[t._v("导入.css 文件将会把内容插入到"),s("code",[t._v("<style>")]),t._v("标签中，同时也带有 HMR 支持。同时支持.scss/.sass/.less/.stylus 等格式文件。")])]),t._v(" "),s("h3",{attrs:{id:"方便"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方便"}},[t._v("#")]),t._v(" 方便")]),t._v(" "),s("ol",[s("li",[t._v("开箱即用，对比 webpack，少了很多 plugin 和 loader 配置。")]),t._v(" "),s("li",[t._v("对于库开发者，也可以通过简单的配置即可打包输出多种格式的包。")]),t._v(" "),s("li",[t._v("开发和生产共享了 rollup 的插件接口，大部分 rollup 插件可以在 vite 上使用。")]),t._v(" "),s("li",[t._v("类型化配置，配置文件可以使用 ts，具有配置类型提示。")])]),t._v(" "),s("h3",{attrs:{id:"webassembly"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webassembly"}},[t._v("#")]),t._v(" WebAssembly")]),t._v(" "),s("p",[t._v("预编译的.wasm 文件可以直接被导入——默认导出一个函数，返回值为所导出的 wasm 实例对象的 Promise。")]),t._v(" "),s("h3",{attrs:{id:"构建优化-异步-chunk-加载优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建优化-异步-chunk-加载优化"}},[t._v("#")]),t._v(" 构建优化——异步 chunk 加载优化")]),t._v(" "),s("p",[t._v("无优化时，当异步 chunkA 被导入时，浏览器将必须先请求和解析 A，然后才能弄清楚它也需要公用 chunkC，这会导致额外的网络请求开销；")]),t._v(" "),s("p",[t._v("优化后，Vite 使用一个预加载步骤自动重写代码，来分割动态导入调用，以实现当 A 被请求时，C 也将被同时请求；")]),t._v(" "),s("p",[t._v("Vite 的优化会跟踪所有的直接导入，无论导入的深度如何，都能够完全消除不必要的往返。")]),t._v(" "),s("h3",{attrs:{id:"支持-ssr"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#支持-ssr"}},[t._v("#")]),t._v(" 支持 SSR")]),t._v(" "),s("h2",{attrs:{id:"defineconfig-配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#defineconfig-配置"}},[t._v("#")]),t._v(" defineConfig 配置")]),t._v(" "),s("ul",[s("li",[t._v("optimizeDeps.exclude: 在预构建中强制排除的依赖项。(mark as external)")])]),t._v(" "),s("h2",{attrs:{id:"迁移到-vite"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#迁移到-vite"}},[t._v("#")]),t._v(" 迁移到 Vite")]),t._v(" "),s("h3",{attrs:{id:"新项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新项目"}},[t._v("#")]),t._v(" 新项目")]),t._v(" "),s("p",[t._v("使用 Vite 提供的模板工具：@vitejs/create-app")]),t._v(" "),s("h3",{attrs:{id:"老项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#老项目"}},[t._v("#")]),t._v(" 老项目")]),t._v(" "),s("ol",[s("li",[t._v("webpack 项目：wp2vite，保留原来的 webpack 配置，把 vite 的配置注入到项目中以支持 vite")])])])}),[],!1,null,null,null);e.default=v.exports}}]);